# Aimax 확장 프로그램 아키텍처

이 문서는 Aimax Chrome 확장 프로그램의 기술적인 구조와 주요 구성 요소, 그리고 구성 요소 간의 상호 작용 방식을 설명합니다.

## 1. 개요

Aimax 확장 프로그램은 사용자가 웹 페이지와 상호 작용하는 방식을 개선하고 특정 작업을 자동화하는 것을 목표로 합니다. 이를 위해 백그라운드 스크립트, 컨텐츠 스크립트, 팝업 UI 등 여러 구성 요소를 활용합니다.

## 2. 주요 구성 요소

확장 프로그램은 다음과 같은 주요 파일들로 구성됩니다.

### 2.1. `manifest.json`

확장 프로그램의 핵심 설정 파일입니다. 다음과 같은 주요 정보를 정의합니다.

-   **`name`**, **`version`**, **`description`**: 확장 프로그램의 기본 정보.
-   **`permissions`**: 확장 프로그램이 사용하는 브라우저 API에 대한 권한을 명시합니다. (예: `storage`, `activeTab`, `scripting`).
-   **`background`**: 백그라운드에서 실행되는 서비스 워커 스크립트 (`background.js`)를 지정합니다.
-   **`content_scripts`**: 특정 웹 페이지에 삽입되어 실행되는 컨텐츠 스크립트 (`content.js`)를 정의하고, 어떤 페이지에 삽입될지 (`matches`) 지정합니다.
-   **`action`**: 사용자가 클릭할 확장 프로그램 아이콘과 팝업 UI (`popup.html`)를 설정합니다.

### 2.2. `background.js`

확장 프로그램의 중앙 허브 역할을 하는 백그라운드 스크립트입니다. 브라우저가 실행되는 동안 항상 활성 상태를 유지하며, 다음과 같은 주요 작업을 수행합니다.

-   **이벤트 리스닝**: `chrome.runtime.onInstalled`, `chrome.runtime.onMessage` 등 브라우저 및 확장 프로그램의 주요 이벤트를 수신하고 처리합니다.
-   **상태 관리**: `chrome.storage` API를 사용하여 확장 프로그램의 전역 상태나 사용자 설정을 저장하고 관리합니다.
-   **메시지 중계**: 팝업(`popup.js`)과 컨텐츠 스크립트(`content.js`) 간의 통신을 중계합니다.

### 2.3. `content.js`

웹 페이지의 컨텍스트에서 직접 실행되는 스크립트입니다. `manifest.json`에 정의된 조건에 맞는 페이지가 로드될 때마다 삽입됩니다.

-   **DOM 조작**: 웹 페이지의 DOM(Document Object Model)에 접근하여 정보를 읽거나, 페이지의 내용을 수정하고, 새로운 UI 요소를 추가합니다.
-   **페이지 이벤트 감지**: 페이지 내의 사용자 입력이나 변경 사항을 감지합니다.
-   **백그라운드와 통신**: 처리한 데이터를 백그라운드 스크립트로 보내거나, 백그라운드로부터 지시를 받아 페이지를 조작합니다.

### 2.4. `popup.html` & `popup.js`

사용자가 브라우저 툴바의 확장 프로그램 아이콘을 클릭했을 때 나타나는 팝업 창을 정의합니다.

-   **`popup.html`**: 팝업 창의 HTML 구조를 정의합니다. 버튼, 텍스트 필드 등 사용자 인터페이스(UI) 요소들이 포함됩니다.
-   **`popup.js`**: 팝업 UI의 동작을 처리하는 JavaScript 코드입니다.
    -   `popup.html`에 있는 UI 요소들의 이벤트 리스너(예: 클릭 이벤트)를 등록합니다.
    -   사용자 입력을 받아 백그라운드 스크립트(`background.js`)로 메시지를 보내 특정 작업을 요청합니다.

## 3. 동작 흐름 (예시)

일반적인 사용자 시나리오는 다음과 같은 흐름으로 동작합니다.

1.  **사용자 액션**: 사용자가 툴바의 아이콘을 클릭하여 `popup.html`을 엽니다.
2.  **팝업에서 요청**: 사용자가 팝업 창의 버튼을 클릭하면, `popup.js`가 이벤트를 감지하고 `chrome.runtime.sendMessage()`를 사용하여 `background.js`에 메시지를 보냅니다.
3.  **백그라운드 처리**: `background.js`는 `onMessage` 리스너를 통해 메시지를 수신합니다. 메시지 내용에 따라 필요한 데이터를 가공하거나, `chrome.storage`에서 데이터를 읽어옵니다.
4.  **컨텐츠 스크립트에 전달**: `background.js`가 현재 활성화된 탭의 `content.js`에 작업을 지시해야 하는 경우, `chrome.tabs.sendMessage()`를 사용하여 해당 탭으로 메시지를 전달합니다.
5.  **웹 페이지 조작**: `content.js`는 메시지를 수신하고, 전달받은 데이터를 기반으로 현재 웹 페이지의 DOM을 조작하여 사용자에게 시각적인 변화를 보여줍니다.

## 4. 데이터 통신

구성 요소 간의 통신은 Chrome의 메시징 API를 통해 비동기적으로 이루어집니다.

-   **`popup.js` -> `background.js`**: `chrome.runtime.sendMessage()`
-   **`content.js` -> `background.js`**: `chrome.runtime.sendMessage()`
-   **`background.js` -> `content.js`**: `chrome.tabs.sendMessage()` (특정 탭을 지정해야 함)

이러한 구조를 통해 각 구성 요소는 자신의 역할에만 집중하고, 메시지를 통해 유기적으로 협력하여 확장 프로그램의 전체 기능을 완성합니다.
